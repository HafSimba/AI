<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Ricerca Web - Amico Virtuale AI</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: white;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #2a3f5f;
        }
        
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .test-button:hover {
            background: #2980b9;
        }
        
        .results {
            background: #0f1419;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #2a3f5f;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .status {
            color: #f39c12;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
        .info { color: #3498db; }
        
        h1 {
            text-align: center;
            color: #3498db;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #2ecc71;
            border-bottom: 2px solid #2ecc71;
            padding-bottom: 5px;
        }
        
        .query-input {
            width: 100%;
            padding: 10px;
            background: #0f1419;
            border: 1px solid #2a3f5f;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .provider-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .provider-card {
            background: #2c3e50;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .provider-enabled {
            border: 2px solid #2ecc71;
        }
        
        .provider-disabled {
            border: 2px solid #e74c3c;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Test Sistema Ricerca Web</h1>
        
        <!-- Stato Configurazione -->
        <div class="test-section">
            <h2>üìã Configurazione Ricerca</h2>
            <div id="config-status" class="status">Caricamento configurazione...</div>
            <div class="provider-status" id="provider-status"></div>
        </div>
        
        <!-- Test Ricerca Generale -->
        <div class="test-section">
            <h2>üîç Test Ricerca Generale</h2>
            <input type="text" id="search-query" class="query-input" placeholder="Inserisci query di ricerca (es: intelligenza artificiale)" value="intelligenza artificiale">
            <br>
            <button class="test-button" onclick="testGeneralSearch()">üåê Ricerca Completa</button>
            <button class="test-button" onclick="testDuckDuckGo()">ü¶Ü Solo DuckDuckGo</button>
            <button class="test-button" onclick="testWikipedia()">üìö Solo Wikipedia</button>
            <button class="test-button" onclick="testGitHub()">üíª Solo GitHub</button>
            <div id="search-results" class="results"></div>
        </div>
        
        <!-- Test Provider Specifici -->
        <div class="test-section">
            <h2>üß™ Test Query Specifiche</h2>
            <button class="test-button" onclick="testSpecificQuery('cos&egrave; il machine learning')">ü§ñ Machine Learning</button>
            <button class="test-button" onclick="testSpecificQuery('javascript framework')">üíª JavaScript Framework</button>
            <button class="test-button" onclick="testSpecificQuery('Leonardo da Vinci')">üé® Leonardo da Vinci</button>
            <button class="test-button" onclick="testSpecificQuery('python programming')">üêç Python Programming</button>
            <div id="specific-results" class="results"></div>
        </div>
        
        <!-- Test Performance -->
        <div class="test-section">
            <h2>‚ö° Test Performance</h2>
            <button class="test-button" onclick="testPerformance()">üìä Test Velocit√†</button>
            <button class="test-button" onclick="testTimeout()">‚è±Ô∏è Test Timeout</button>
            <div id="performance-results" class="results"></div>
        </div>
        
        <!-- Test Deduplicazione -->
        <div class="test-section">
            <h2>üîÑ Test Deduplicazione</h2>
            <button class="test-button" onclick="testDeduplication()">üßπ Test Deduplica</button>
            <div id="dedup-results" class="results"></div>
        </div>
        
        <!-- Log Debug -->
        <div class="test-section">
            <h2>üêõ Log Debug</h2>
            <button class="test-button" onclick="clearLog()">üóëÔ∏è Pulisci Log</button>
            <div id="debug-log" class="results"></div>
        </div>
    </div>

    <!-- Include i file necessari -->
    <script src="config.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Variabili globali per test
        let testInstance = null;
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Inizializzazione test ricerca web...');
            
            // Crea istanza temporanea per test
            try {
                testInstance = {
                    searchWeb: VirtualFriend.prototype.searchWeb.bind({
                        searchWithTimeout: VirtualFriend.prototype.searchWithTimeout.bind({}),
                        getSearchFunction: VirtualFriend.prototype.getSearchFunction.bind({}),
                        searchDuckDuckGo: VirtualFriend.prototype.searchDuckDuckGo.bind({}),
                        searchWikipedia: VirtualFriend.prototype.searchWikipedia.bind({}),
                        searchWikidata: VirtualFriend.prototype.searchWikidata.bind({}),
                        searchGitHub: VirtualFriend.prototype.searchGitHub.bind({}),
                        deduplicateResults: VirtualFriend.prototype.deduplicateResults.bind({}),
                        formatSearchResults: VirtualFriend.prototype.formatSearchResults.bind({}),
                        getResultEmoji: VirtualFriend.prototype.getResultEmoji.bind({}),
                        getProviderBadge: VirtualFriend.prototype.getProviderBadge.bind({})
                    })
                };
                
                showConfigStatus();
                log('‚úÖ Test instance creata con successo');
                
            } catch (error) {
                log(`‚ùå Errore creazione test instance: ${error.message}`, 'error');
            }
        });
        
        // Mostra stato configurazione
        function showConfigStatus() {
            const configDiv = document.getElementById('config-status');
            const providerDiv = document.getElementById('provider-status');
            
            if (typeof AI_CONFIG !== 'undefined' && AI_CONFIG.search) {
                const search = AI_CONFIG.search;
                configDiv.innerHTML = `
                    <span class="success">‚úÖ Configurazione caricata</span><br>
                    Ricerca: ${search.enabled ? '<span class="success">Abilitata</span>' : '<span class="error">Disabilitata</span>'}<br>
                    Max risultati: ${search.maxResults}<br>
                    Timeout: ${search.timeout}ms<br>
                    Deduplicazione: ${search.deduplication ? 'S√¨' : 'No'}
                `;
                
                // Mostra stato provider
                let providerHtml = '';
                for (const [name, config] of Object.entries(search.providers)) {
                    providerHtml += `
                        <div class="provider-card ${config.enabled ? 'provider-enabled' : 'provider-disabled'}">
                            <strong>${config.name}</strong><br>
                            ${config.enabled ? '‚úÖ Abilitato' : '‚ùå Disabilitato'}<br>
                            Priorit√†: ${config.priority || 'N/A'}
                        </div>
                    `;
                }
                providerDiv.innerHTML = providerHtml;
                
            } else {
                configDiv.innerHTML = '<span class="error">‚ùå Configurazione non trovata</span>';
            }
        }
        
        // Funzioni di test
        async function testGeneralSearch() {
            const query = document.getElementById('search-query').value;
            if (!query) {
                log('‚ö†Ô∏è Inserisci una query di ricerca', 'error');
                return;
            }
            
            log(`üîç Avvio ricerca generale per: "${query}"`);
            const startTime = Date.now();
            
            try {
                if (!testInstance) {
                    throw new Error('Test instance non disponibile');
                }
                
                const results = await testInstance.searchWeb(query);
                const endTime = Date.now();
                
                document.getElementById('search-results').textContent = JSON.stringify(results, null, 2);
                log(`‚úÖ Ricerca completata in ${endTime - startTime}ms - ${results.results.length} risultati`, 'success');
                
            } catch (error) {
                const endTime = Date.now();
                log(`‚ùå Errore ricerca (${endTime - startTime}ms): ${error.message}`, 'error');
                document.getElementById('search-results').textContent = error.message;
            }
        }
        
        async function testDuckDuckGo() {
            const query = document.getElementById('search-query').value;
            log(`ü¶Ü Test DuckDuckGo: "${query}"`);
            
            try {
                const config = AI_CONFIG.search.providers.duckduckgo;
                const searchFn = VirtualFriend.prototype.searchDuckDuckGo.bind({});
                const results = await searchFn(query, config);
                
                document.getElementById('search-results').textContent = JSON.stringify(results, null, 2);
                log(`‚úÖ DuckDuckGo: ${results.length} risultati`, 'success');
                
            } catch (error) {
                log(`‚ùå Errore DuckDuckGo: ${error.message}`, 'error');
            }
        }
        
        async function testWikipedia() {
            const query = document.getElementById('search-query').value;
            log(`üìö Test Wikipedia: "${query}"`);
            
            try {
                const config = AI_CONFIG.search.providers.wikipedia;
                const searchFn = VirtualFriend.prototype.searchWikipedia.bind({});
                const results = await searchFn(query, config);
                
                document.getElementById('search-results').textContent = JSON.stringify(results, null, 2);
                log(`‚úÖ Wikipedia: ${results.length} risultati`, 'success');
                
            } catch (error) {
                log(`‚ùå Errore Wikipedia: ${error.message}`, 'error');
            }
        }
        
        async function testGitHub() {
            const query = document.getElementById('search-query').value;
            log(`üíª Test GitHub: "${query}"`);
            
            try {
                const config = AI_CONFIG.search.providers.github;
                const searchFn = VirtualFriend.prototype.searchGitHub.bind({});
                const results = await searchFn(query, config);
                
                document.getElementById('search-results').textContent = JSON.stringify(results, null, 2);
                log(`‚úÖ GitHub: ${results.length} risultati`, 'success');
                
            } catch (error) {
                log(`‚ùå Errore GitHub: ${error.message}`, 'error');
            }
        }
        
        async function testSpecificQuery(query) {
            log(`üß™ Test query specifica: "${query}"`);
            document.getElementById('search-query').value = query;
            
            const startTime = Date.now();
            try {
                const results = await testInstance.searchWeb(query);
                const endTime = Date.now();
                
                document.getElementById('specific-results').textContent = JSON.stringify(results, null, 2);
                log(`‚úÖ Query specifica completata in ${endTime - startTime}ms`, 'success');
                
            } catch (error) {
                log(`‚ùå Errore query specifica: ${error.message}`, 'error');
            }
        }
        
        async function testPerformance() {
            log('üìä Avvio test performance...');
            const queries = ['AI', 'programming', 'science', 'technology', 'music'];
            const results = [];
            
            for (const query of queries) {
                const startTime = Date.now();
                try {
                    await testInstance.searchWeb(query);
                    const endTime = Date.now();
                    results.push(`${query}: ${endTime - startTime}ms`);
                } catch (error) {
                    results.push(`${query}: ERROR - ${error.message}`);
                }
            }
            
            document.getElementById('performance-results').textContent = results.join('\n');
            log('üìä Test performance completato', 'success');
        }
        
        async function testTimeout() {
            log('‚è±Ô∏è Test timeout...');
            
            // Modifica temporaneamente il timeout
            const originalTimeout = AI_CONFIG.search.timeout;
            AI_CONFIG.search.timeout = 1000; // 1 secondo
            
            try {
                const startTime = Date.now();
                await testInstance.searchWeb('test timeout query');
                const endTime = Date.now();
                
                document.getElementById('performance-results').textContent = `Test completato in ${endTime - startTime}ms (timeout: 1000ms)`;
                log('‚úÖ Test timeout completato', 'success');
                
            } catch (error) {
                log(`‚è±Ô∏è Timeout rilevato: ${error.message}`, 'info');
            } finally {
                // Ripristina timeout originale
                AI_CONFIG.search.timeout = originalTimeout;
            }
        }
        
        function testDeduplication() {
            log('üîÑ Test deduplicazione...');
            
            const duplicateResults = [
                { title: 'Test 1', url: 'http://example.com/1', snippet: 'Test' },
                { title: 'test 1', url: 'http://example.com/1', snippet: 'Test duplicate' },
                { title: 'Test 2', url: 'http://example.com/2', snippet: 'Different' },
                { title: 'Test 3', url: 'http://example.com/3', snippet: 'Another' },
                { title: 'TEST 1', url: 'http://example.com/1', snippet: 'Same again' }
            ];
            
            try {
                const dedupFn = VirtualFriend.prototype.deduplicateResults.bind({});
                const unique = dedupFn(duplicateResults);
                
                document.getElementById('dedup-results').textContent = 
                    `Input: ${duplicateResults.length} risultati\n` +
                    `Output: ${unique.length} risultati\n\n` +
                    JSON.stringify(unique, null, 2);
                
                log(`üîÑ Deduplicazione: ${duplicateResults.length} ‚Üí ${unique.length}`, 'success');
                
            } catch (error) {
                log(`‚ùå Errore deduplicazione: ${error.message}`, 'error');
            }
        }
        
        // Utility
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString('it-IT');
            const logEntry = `[${timestamp}] ${message}\n`;
            
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('debug-log').textContent = '';
            log('üóëÔ∏è Log pulito');
        }
    </script>
</body>
</html>
